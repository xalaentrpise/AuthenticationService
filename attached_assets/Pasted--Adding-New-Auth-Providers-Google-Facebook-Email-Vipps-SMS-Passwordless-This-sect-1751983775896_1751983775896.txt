
## â• âœ… **Adding New Auth Providers (Google, Facebook, Email, Vipps, SMS, Passwordless)**

This section defines the **architecture, interfaces, configuration, and test requirements** for adding **non-Norwegian providers** to our `@xala-technologies/authentication` package.

### ğŸ” 8. Additional Auth Providers

#### ğŸŸ¦ Google OAuth2

* [ ] Create `GoogleOAuthProvider` implementing `IAuthProvider`
* [ ] Use Googleâ€™s OAuth 2.0 flow with PKCE
* [ ] Retrieve user info from Google API
* [ ] Map email â†’ user identity in platform
* [ ] Add `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET` to `.env`

#### ğŸŸ¦ Facebook OAuth2

* [ ] Create `FacebookOAuthProvider` implementing `IAuthProvider`
* [ ] Integrate Facebook Login API
* [ ] Map `facebookId` to internal user
* [ ] Add `FACEBOOK_APP_ID` and `FACEBOOK_APP_SECRET` to `.env`

#### ğŸ“§ Email/Password

* [ ] Create `EmailAuthProvider` with:

  * [ ] Registration + hashed password (bcrypt or Argon2)
  * [ ] Login and password verification
  * [ ] Password reset with token expiration
* [ ] Store `email` + `hashedPassword` in secure table

#### ğŸ”„ Passwordless (Email Magic Link)

* [ ] Create `MagicLinkAuthProvider`
* [ ] Generate signed one-time token (JWT or random UUID)
* [ ] Send via email using `@xala-technologies/notification-service`
* [ ] Verify and authenticate link within TTL

#### ğŸ“± SMS-based OTP

* [ ] Create `SMSOTPAuthProvider`
* [ ] Generate OTP code (6-digit)
* [ ] Send via SMS using integration from `@xala-technologies/notification-service`
* [ ] Store hash of OTP temporarily in cache (Redis)
* [ ] Implement time-bound verification + throttling

#### ğŸ’³ Vipps Login

* [ ] Create `VippsAuthProvider`
* [ ] Integrate Vipps Login ([https://developer.vippsmobilepay.com](https://developer.vippsmobilepay.com))
* [ ] Handle redirect callback + token exchange
* [ ] Map user to platform identity via `pid` or `email`

---

### ğŸ›  Shared Tasks for All Providers

* [ ] Update `IAuthProvider` interface to standardize:

  * `authenticate(credentials)`
  * `getUserProfile(token)`
  * `getRedirectURL(state)`
  * `handleCallback(params)`

* [ ] Update `providers/index.ts` to auto-register all providers

* [ ] Add dynamic provider selector (based on tenant config)

* [ ] Inject via DI container or provider registry

---

### ğŸ§ª Testing & Mocks

* [ ] Add mock provider classes in `__mocks__`
* [ ] Create end-to-end test flows:

  * [ ] Google, Facebook â†’ Login via redirect flow
  * [ ] Email â†’ Register, Login, Reset Password
  * [ ] Passwordless â†’ Send + Verify magic link
  * [ ] SMS â†’ Send + Verify OTP
  * [ ] Vipps â†’ Callback â†’ Token â†’ User map

---

### ğŸ“š Documentation

* [ ] Create `docs/providers/` for each provider
* [ ] Add configuration instructions per tenant
* [ ] Include fallback guides for custom UIs